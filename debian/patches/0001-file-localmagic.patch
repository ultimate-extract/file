Authors:
 Michael Piefel <piefel@debian.org>,
 Judit Foglszinger <fgrfgr@freenet.de>
Description:
 No longer includes Localstuff in /usr/share/misc/magic, local definitions
 should go to /etc/magic.

diff -Naurp file.orig/magic/Header file/magic/Header
--- file.orig/magic/Header
+++ file/magic/Header
@@ -1,5 +1,6 @@
 # Magic data for file(1) command.
-# Format is described in magic(files), where:
-# files is 5 on V7 and BSD, 4 on SV, and ?? on SVID.
+# Format is described in in magic(5).
 # Don't edit this file, edit /etc/magic or send your magic improvements
-# to the maintainers, at file@mx.gw.com
+# to the upstream maintainers, at file@mx.gw.com
+# or send your suggested inclusions
+# as a wishlist bug against file (using the reportbug utility).
diff -Naurp file.orig/magic/magic.local file/magic/magic.local
--- file.orig/magic/magic.local
+++ file/magic/magic.local
@@ -0,0 +1,3 @@
+# Magic local data for file(1) command.
+# Insert here your local magic data. Format is described in magic(5).
+
diff -Naurp file.orig/src/apprentice.c file/src/apprentice.c
--- file.orig/src/apprentice.c
+++ file/src/apprentice.c
@@ -419,7 +419,7 @@ apprentice_1(struct magic_set *ms, const
 #ifndef COMPILE_ONLY
 	map = apprentice_map(ms, fn);
 	if (map == NULL) {
-		if (ms->flags & MAGIC_CHECK)
+		if (ms->flags & MAGIC_CHECK && strcmp("/etc/magic", fn) != 0)
 			file_magwarn(ms, "using regular magic file `%s'", fn);
 		map = apprentice_load(ms, fn, action);
 		if (map == NULL)
diff -Naurp file.orig/src/Makefile.am file/src/Makefile.am
--- file.orig/src/Makefile.am
+++ file/src/Makefile.am
@@ -4,7 +4,7 @@ include_HEADERS = magic.h
 
 bin_PROGRAMS = file
 
-AM_CPPFLAGS = -DMAGIC='"$(MAGIC)"'
+AM_CPPFLAGS = -DMAGIC='"/etc/magic:$(MAGIC)"'
 AM_CFLAGS = $(CFLAG_VISIBILITY) @WARNINGS@
 
 libmagic_la_SOURCES = magic.c apprentice.c softmagic.c ascmagic.c \
diff -Naurp file.orig/src/Makefile.in file/src/Makefile.in
--- file.orig/src/Makefile.in
+++ file/src/Makefile.in
@@ -247,7 +247,7 @@ top_srcdir = @top_srcdir@
 MAGIC = $(pkgdatadir)/magic
 lib_LTLIBRARIES = libmagic.la
 include_HEADERS = magic.h
-AM_CPPFLAGS = -DMAGIC='"$(MAGIC)"'
+AM_CPPFLAGS = -DMAGIC='"/etc/magic:$(MAGIC)"'
 AM_CFLAGS = $(CFLAG_VISIBILITY) @WARNINGS@
 libmagic_la_SOURCES = magic.c apprentice.c softmagic.c ascmagic.c \
 	encoding.c compress.c is_tar.c readelf.c print.c fsmagic.c \
